<% layout('../layouts/layout.ejs') -%>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
<style>
    .table-row-link {
        color: #000000;
    }

    .table-row-link:hover {
        color: white
    }

    .img-data-row {
        width: 70px;
        height: 70px;
    }

    #image-to-change {
        width: 100%;
        height: 300px;
        object-fit: scale-down;
        margin-bottom: 10px;
    }
    /* .select2-container{
        top: 12px;
    } */
</style>
<div class="container-fluid" ng-controller="listController">
    <div class="row">
        <div class="col-md-12">
            <button type="button" id="openModelCreateEmployee" class="btn btn-primary" data-toggle="modal"
                data-target="#modalCreateEmployee">
                Thêm Người Dùng
            </button>
            <div class="card">
                <div class="card-header card-header-primary" style="z-index: 1 !important">
                    <div class="row">
                        <div class="col-md-2" style="width: max-content;">
                            <h4 class="card-title" style="line-height: 50px">Nhân Viên</h4>
                        </div>
                        <div class="col-md-10">
                            <select style="width: 15%;" class="selected" id="selectedDistrict"
                                ng-model="selectedDistrict" ng-change="generateFindObj()">
                                <option value="">--- Chọn Quận ---</option>
                                <option ng-repeat="district in districts" value="{{district._id}}">
                                    {{district.name}}
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table" id="employees-table" style="width: 100% !important">
                            <thead class="text-primary">
                                <tr>
                                    <th style="width: 5%">Id</th>
                                    <th style="width: 15%">Tên Nhân Viên</th>
                                    <th style="width: 10%">Chức Vụ</th>
                                    <th style="width: 20%">Địa Chỉ</th>
                                    <th style="width: 20%">Ngày Tạo</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="modalCreateEmployee" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-center" id="exampleModalLongTitle">Thêm Người Dùng</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-container">
                        <form id="create-employee">
                            <div class="pointer">
                                <img id="image-to-change" src="/images/logo/user-avatar.jpg" onclick="chooseFile()" />
                                <input id="file" type="file" accept="avatar/*" style="display:none"
                                    onchange="onChangeImage(event)" />
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="bmd-label-floating">Họ & Tên</label>
                                        <input type="text" class="form-control" ng-model="employee.name"
                                            id="fullname" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="bmd-label-floating">Email</label>
                                        <input type="text" class="form-control" ng-model="employee.email" id="email" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group" style="margin-top: 29px;">
                                        <label class="bmd-label-floating">Ngày Sinh</label>
                                        <input type="text" class="form-control" name="birthdate" id="birthdate"
                                            value=" " />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="bmd-label-floating">Giới Tính</label>
                                        <select style="width: 100%;" id="gender" class="form-control"
                                            ng-model="employee.gender">
                                            <option value="Nam">Nam</option>
                                            <option value="Nữ">Nữ</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group" ng-if="user.role === 'manager'">
                                        <label class="bmd-label-floating" style="top: -30px">Chức Vụ</label>
                                        <input class="form-control" ng-if="user.role === 'manager'"
                                            value="{{role.WORKER}}" style="margin-top: 38px;" disabled />
                                    </div>
                                    <div class="form-group" ng-if="user.role === 'admin'">
                                        <label class="bmd-label-floating">Chức Vụ</label>
                                        <select style="width: 100%;" class="form-control" ng-model="employee.role"
                                            id="role">
                                            <option value="{{role.MANAGER}}">Quản Lý</option>
                                            <option value="{{role.WORKER}}">Nhân Viên</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="district">Quận</label>
                                    <select style="width: 100%" class="form-control" ng-model="district" id="district">
                                        <option ng-repeat="district in districts" value="{{district._id}}">
                                            {{district.name}}</option>
                                    </select>
                                </div>
                                <div class="col-md-6" style="top: 10px;">
                                    <div class="form-group">
                                        <label class="bmd-label-floating">Địa Chỉ</label>
                                        <input type="text" class="form-control" id="address"
                                            ng-model="employee.address" />
                                    </div>
                                </div>
                            </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group" style="margin-top: 15px;">
                                <label class="bmd-label-floating">Tên Tài Khoản</label>
                                <input type="text" id="username" class="form-control" ng-model="employee.username" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group" style="margin-top: 15px;">
                                <label class="bmd-label-floating">Mật Khẩu</label>
                                <input type="password" id="password" class="form-control"
                                    ng-model="employee.password" />
                            </div>
                        </div>
                    </div>
                    </form>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Thoát</button>
                    <button type="button" class="btn btn-primary float-right" id="createEmployeeBtn">Tạo</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/javascripts/employee/list.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
<script>
    clickSideBar('employee-page')

    $(document).ready(function () {
        let defaultDate = new Date('1-1-' + (new Date().getFullYear() - 60))
        $('#birthdate').datepicker({
            dateFormat: 'dd/mm/yy',
            autoclose: true,
            changeMonth: true,
            changeYear: true,
            yearRange: '-60:-18'
        }).datepicker('setDate', defaultDate)
        setTimeout(() => {
            numberFormat()
            $('#fullname').focus()
            $('#gender').select2().select2('val', $('#gender option:eq(1)').val());
            $('#role').select2().select2('val', $('#role option:eq(1)').val());
            $('#district').select2().select2('val', $('#district option:eq(1)').val());
            $('.selected').select2()
            $("#selectedDistrict").select2().next().css('top','10px')
        }, 200);
    });
    function chooseFile() {
        $('#file').click()
    }

    var imgtag = document.getElementById('image-to-change')
    var newAvatar

    function onChangeImage(event) {
        var selectedFile = event.target.files[0]
        var getImagePath = URL.createObjectURL(event.target.files[0])
        imgtag.src = getImagePath
        newAvatar = selectedFile
    }
</script>